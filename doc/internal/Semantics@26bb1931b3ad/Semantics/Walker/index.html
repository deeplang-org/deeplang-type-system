<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Walker (Semantics@26bb1931b3ad.Semantics.Walker)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">Semantics@26bb1931b3ad</a> &#x00BB; <a href="../index.html">Semantics</a> &#x00BB; Walker</nav><h1>Module <code>Semantics.Walker</code></h1><nav class="toc"><ul><li><a href="#context">Context</a></li><li><a href="#helper">Helper</a></li><li><a href="#implementation">Implementation</a></li><li><a href="#usage">Usage</a></li></ul></nav></header><aside><p>This module walks AST from <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html"><code>ParseTree</code></a>, to do <b>name resolution</b> and <b>type checking</b> in one pass.</p></aside><section><header><h2 id="context"><a href="#context" class="anchor"></a>Context</h2></header><dl><dt class="spec type" id="type-nametbl"><a href="#type-nametbl" class="anchor"></a><code><span class="keyword">type</span> nametbl</code><code> = <span><span>(<a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-variable">Syntax.ParseTree.variable</a>, <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-symbol">Syntax.ParseTree.symbol</a>)</span> Stdlib.Hashtbl.t</span></code></dt><dt class="spec type" id="type-scope"><a href="#type-scope" class="anchor"></a><code><span class="keyword">type</span> scope</code><code> = <span><a href="index.html#type-nametbl">nametbl</a> list</span></code></dt><dt class="spec type" id="type-context"><a href="#type-context" class="anchor"></a><code><span class="keyword">type</span> context</code><code> = </code><code>{</code><table class="record"><tr id="type-context.table" class="anchored"><td class="def field"><a href="#type-context.table" class="anchor"></a><code>table : <a href="../Table/index.html#type-table">Table.table</a>;</code></td></tr><tr id="type-context.nametbl" class="anchored"><td class="def field"><a href="#type-context.nametbl" class="anchor"></a><code><span class="keyword">mutable</span> nametbl : <a href="index.html#type-nametbl">nametbl</a>;</code></td></tr><tr id="type-context.scope" class="anchored"><td class="def field"><a href="#type-context.scope" class="anchor"></a><code><span class="keyword">mutable</span> scope : <a href="index.html#type-scope">scope</a>;</code></td><td class="doc"><p>nametbl::scope</p></td></tr><tr id="type-context.this" class="anchored"><td class="def field"><a href="#type-context.this" class="anchor"></a><code><span class="keyword">mutable</span> this : <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ">Syntax.ParseTree.typ</a>;</code></td><td class="doc"><p>type This of one struct or ADT</p></td></tr><tr id="type-context.rety" class="anchored"><td class="def field"><a href="#type-context.rety" class="anchor"></a><code><span class="keyword">mutable</span> rety : <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ">Syntax.ParseTree.typ</a>;</code></td><td class="doc"><p>return type of function</p></td></tr></table><code>}</code></dt></dl></section><section><header><h2 id="helper"><a href="#helper" class="anchor"></a>Helper</h2></header><aside><p>Those used in <a href="index.html"><code>Walker</code></a>, which is not yet defined in <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html"><code>ParseTree</code></a></p></aside></section><section><header><h2 id="implementation"><a href="#implementation" class="anchor"></a>Implementation</h2></header><aside><p>scope block { stmt_list }</p></aside><dl><dt class="spec value" id="val-scope_beg"><a href="#val-scope_beg" class="anchor"></a><code><span class="keyword">val</span> scope_beg : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-scope_end"><a href="#val-scope_end" class="anchor"></a><code><span class="keyword">val</span> scope_end : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> unit</code></dt></dl><aside><p>add variable into nametbl and table</p></aside><dl><dt class="spec value" id="val-add_variable"><a href="#val-add_variable" class="anchor"></a><code><span class="keyword">val</span> add_variable : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-symbol">Syntax.ParseTree.symbol</a> <span>&#45;&gt;</span> <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-mutability">Syntax.ParseTree.mutability</a> <span>&#45;&gt;</span> <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-variable">Syntax.ParseTree.variable</a> <span>&#45;&gt;</span> <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ">Syntax.ParseTree.typ</a> option</span> <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-find_var_opt"><a href="#val-find_var_opt" class="anchor"></a><code><span class="keyword">val</span> find_var_opt : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-variable">Syntax.ParseTree.variable</a> <span>&#45;&gt;</span> <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-symbol">Syntax.ParseTree.symbol</a> option</span></code></dt></dl><aside><p>call add_variable</p><pre><code class="ml"># walk_pattern context pattern typ</code></pre><p><code>typ</code> is the type of expr corresponding to <code>pattern</code></p><p>In <code> let (x, _) = (3, 1.1) </code>, <code>pattern</code> is <code>(x, _)</code>, and <code>typ</code> is <code>(i64, f64)</code>.</p></aside><dl><dt class="spec value" id="val-unsupport_generics"><a href="#val-unsupport_generics" class="anchor"></a><code><span class="keyword">val</span> unsupport_generics : <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ">Syntax.ParseTree.typ</a> list</span> <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-walk_type"><a href="#val-walk_type" class="anchor"></a><code><span class="keyword">val</span> walk_type : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ">Syntax.ParseTree.typ</a> <span>&#45;&gt;</span> bool</code></dt><dd><p>check TyNamed whether in context.typ</p></dd></dl><dl><dt class="spec value" id="val-walk_pattern"><a href="#val-walk_pattern" class="anchor"></a><code><span class="keyword">val</span> walk_pattern : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-pattern">Syntax.ParseTree.pattern</a> <span>&#45;&gt;</span> <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ">Syntax.ParseTree.typ</a> <span>&#45;&gt;</span> unit</code></dt></dl><aside><p>Type Check implemented in <code>walk_expr</code>:</p><pre><code class="ml"># let ty = walk_expr context expr
  val ty : typ = &lt;...&gt;</code></pre><p><code>ty</code> is the type of expr.</p></aside><dl><dt class="spec value" id="val-walk_expr"><a href="#val-walk_expr" class="anchor"></a><code><span class="keyword">val</span> walk_expr : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-expr">Syntax.ParseTree.expr</a> <span>&#45;&gt;</span> <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ">Syntax.ParseTree.typ</a></code></dt><dt class="spec value" id="val-walk_stmt"><a href="#val-walk_stmt" class="anchor"></a><code><span class="keyword">val</span> walk_stmt : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-stmt">Syntax.ParseTree.stmt</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>walk stmt As for return type check, please set <code>context.rety</code></p><pre><code class="ml">walk_stmt context stmt ;;</code></pre><p>When meeting a return-stmt, <a href="index.html#val-walk_stmt"><code>walk_stmt</code></a> will compare <code>context.rety</code> with the type of <code>expr</code></p></dd></dl><dl><dt class="spec value" id="val-walk_func_decl"><a href="#val-walk_func_decl" class="anchor"></a><code><span class="keyword">val</span> walk_func_decl : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-func_name">Syntax.ParseTree.func_name</a> <span>&#45;&gt;</span> <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-func_arg">Syntax.ParseTree.func_arg</a> list</span> <span>&#45;&gt;</span> <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ">Syntax.ParseTree.typ</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>check func name, and collect type info</p><pre><code class="ml"># walk_func_decl context name parameters return_type</code></pre></dd></dl><dl><dt class="spec value" id="val-walk_func_stmt"><a href="#val-walk_func_stmt" class="anchor"></a><code><span class="keyword">val</span> walk_func_stmt : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-func_arg">Syntax.ParseTree.func_arg</a> list</span> <span>&#45;&gt;</span> <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ">Syntax.ParseTree.typ</a> <span>&#45;&gt;</span> <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-stmt">Syntax.ParseTree.stmt</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>simply walk function's body inductively</p></dd></dl><dl><dt class="spec value" id="val-walk_method_intf"><a href="#val-walk_method_intf" class="anchor"></a><code><span class="keyword">val</span> walk_method_intf : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-intf_name">Syntax.ParseTree.intf_name</a> option</span> <span>&#45;&gt;</span> <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ_name">Syntax.ParseTree.typ_name</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>impl intf for T with methods, check whether intf exists and whether it has such methods</p></dd></dl><dl><dt class="spec value" id="val-walk_method_decl"><a href="#val-walk_method_decl" class="anchor"></a><code><span class="keyword">val</span> walk_method_decl : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ_name">Syntax.ParseTree.typ_name</a> <span>&#45;&gt;</span> <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-func_name">Syntax.ParseTree.func_name</a> <span>&#45;&gt;</span> <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-func_arg">Syntax.ParseTree.func_arg</a> list</span> <span>&#45;&gt;</span> <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ">Syntax.ParseTree.typ</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>similar to <a href="index.html#val-walk_func_decl"><code>walk_func_decl</code></a>, but checked in the scope of type T</p></dd></dl><dl><dt class="spec value" id="val-walk_method_stmt"><a href="#val-walk_method_stmt" class="anchor"></a><code><span class="keyword">val</span> walk_method_stmt : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-func_arg">Syntax.ParseTree.func_arg</a> list</span> <span>&#45;&gt;</span> <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ">Syntax.ParseTree.typ</a> <span>&#45;&gt;</span> <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-stmt">Syntax.ParseTree.stmt</a> <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-walk_top"><a href="#val-walk_top" class="anchor"></a><code><span class="keyword">val</span> walk_top : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-top_clause">Syntax.ParseTree.top_clause</a> <span>&#45;&gt;</span> unit</code></dt></dl></section><section><header><h2 id="usage"><a href="#usage" class="anchor"></a>Usage</h2></header><aside><p>See <code>WalkerTest.ml</code> .</p></aside></section></div></body></html>