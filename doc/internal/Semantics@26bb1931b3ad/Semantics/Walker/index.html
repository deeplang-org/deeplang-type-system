<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Walker (Semantics@26bb1931b3ad.Semantics.Walker)</title><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">Semantics@26bb1931b3ad</a> &#x00BB; <a href="../index.html">Semantics</a> &#x00BB; Walker</nav><header class="odoc-preamble"><h1>Module <code><span>Semantics.Walker</span></code></h1><p>This module walks AST from <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html"><code>Syntax.ParseTree</code></a>, to do <b>name resolution</b> and <b>type checking</b> in one pass.</p></header><nav class="odoc-toc"><ul><li><a href="#context">Context</a></li><li><a href="#helper">Helper</a></li><li><a href="#implementation">Implementation</a></li><li><a href="#usage">Usage</a></li></ul></nav><div class="odoc-content"><h2 id="context"><a href="#context" class="anchor"></a>Context</h2><div class="odoc-spec"><div class="spec type anchored" id="type-nametbl"><a href="#type-nametbl" class="anchor"></a><code><span><span class="keyword">type</span> nametbl</span><span> =
  <span><span>(<a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-variable">Syntax.ParseTree.variable</a>, <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-symbol">Syntax.ParseTree.symbol</a>)</span> <span class="xref-unresolved">Stdlib</span>.Hashtbl.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-scope"><a href="#type-scope" class="anchor"></a><code><span><span class="keyword">type</span> scope</span><span> = <span><a href="#type-nametbl">nametbl</a> list</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-context"><a href="#type-context" class="anchor"></a><code><span><span class="keyword">type</span> context</span><span> = </span><span>{</span></code><ol><li id="type-context.table" class="def record field anchored"><a href="#type-context.table" class="anchor"></a><code><span>table : <a href="../Table/index.html#type-table">Table.table</a>;</span></code></li><li id="type-context.nametbl" class="def record field anchored"><a href="#type-context.nametbl" class="anchor"></a><code><span><span class="keyword">mutable</span> nametbl : <a href="#type-nametbl">nametbl</a>;</span></code></li><li id="type-context.scope" class="def record field anchored"><a href="#type-context.scope" class="anchor"></a><code><span><span class="keyword">mutable</span> scope : <a href="#type-scope">scope</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>nametbl::scope</p><span class="comment-delim">*)</span></div></li><li id="type-context.this" class="def record field anchored"><a href="#type-context.this" class="anchor"></a><code><span><span class="keyword">mutable</span> this : <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ">Syntax.ParseTree.typ</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>type This of one struct or ADT</p><span class="comment-delim">*)</span></div></li><li id="type-context.rety" class="def record field anchored"><a href="#type-context.rety" class="anchor"></a><code><span><span class="keyword">mutable</span> rety : <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ">Syntax.ParseTree.typ</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>return type of function</p><span class="comment-delim">*)</span></div></li><li id="type-context.checkloop" class="def record field anchored"><a href="#type-context.checkloop" class="anchor"></a><code><span><span class="keyword">mutable</span> checkloop : int;</span></code></li></ol><code><span>}</span></code></div></div><h2 id="helper"><a href="#helper" class="anchor"></a>Helper</h2><p>Those used in <a href="#"><code>Walker</code></a>, which is not yet defined in <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html"><code>Syntax.ParseTree</code></a></p><h2 id="implementation"><a href="#implementation" class="anchor"></a>Implementation</h2><p>scope block { stmt_list }</p><div class="odoc-spec"><div class="spec value anchored" id="val-scope_beg"><a href="#val-scope_beg" class="anchor"></a><code><span><span class="keyword">val</span> scope_beg : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-scope_end"><a href="#val-scope_end" class="anchor"></a><code><span><span class="keyword">val</span> scope_end : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><p>add variable into nametbl and table</p><div class="odoc-spec"><div class="spec value anchored" id="val-add_variable"><a href="#val-add_variable" class="anchor"></a><code><span><span class="keyword">val</span> add_variable : 
  <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-symbol">Syntax.ParseTree.symbol</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-mutability">Syntax.ParseTree.mutability</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-variable">Syntax.ParseTree.variable</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ">Syntax.ParseTree.typ</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_var_opt"><a href="#val-find_var_opt" class="anchor"></a><code><span><span class="keyword">val</span> find_var_opt : 
  <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-variable">Syntax.ParseTree.variable</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-symbol">Syntax.ParseTree.symbol</a> option</span></span></code></div></div><p>call add_variable</p><pre class="language-ocaml"><code># walk_pattern context pattern typ</code></pre><p><code>typ</code> is the type of expr corresponding to <code>pattern</code></p><p>In <code> let (x, _) = (3, 1.1) </code>, <code>pattern</code> is <code>(x, _)</code>, and <code>typ</code> is <code>(i64, f64)</code>.</p><div class="odoc-spec"><div class="spec value anchored" id="val-unsupport_generics"><a href="#val-unsupport_generics" class="anchor"></a><code><span><span class="keyword">val</span> unsupport_generics : <span><span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ">Syntax.ParseTree.typ</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-walk_type"><a href="#val-walk_type" class="anchor"></a><code><span><span class="keyword">val</span> walk_type : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ">Syntax.ParseTree.typ</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>check TyNamed whether in context.typ</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-walk_pattern"><a href="#val-walk_pattern" class="anchor"></a><code><span><span class="keyword">val</span> walk_pattern : 
  <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-pattern">Syntax.ParseTree.pattern</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ">Syntax.ParseTree.typ</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><p>Type Check implemented in <code>walk_expr</code>:</p><pre class="language-ocaml"><code># let ty = walk_expr context expr
  val ty : typ = &lt;...&gt;</code></pre><p><code>ty</code> is the type of expr.</p><div class="odoc-spec"><div class="spec value anchored" id="val-walk_expr"><a href="#val-walk_expr" class="anchor"></a><code><span><span class="keyword">val</span> walk_expr : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-expr">Syntax.ParseTree.expr</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ">Syntax.ParseTree.typ</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-walk_stmt"><a href="#val-walk_stmt" class="anchor"></a><code><span><span class="keyword">val</span> walk_stmt : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-stmt">Syntax.ParseTree.stmt</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>walk stmt As for return type check, please set <code>context.rety</code></p><pre class="language-ocaml"><code>walk_stmt context stmt ;;</code></pre><p>When meeting a return-stmt, <a href="#val-walk_stmt"><code>walk_stmt</code></a> will compare <code>context.rety</code> with the type of <code>expr</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-walk_func_decl"><a href="#val-walk_func_decl" class="anchor"></a><code><span><span class="keyword">val</span> walk_func_decl : 
  <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-func_name">Syntax.ParseTree.func_name</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-func_arg">Syntax.ParseTree.func_arg</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ">Syntax.ParseTree.typ</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>check func name, and collect type info</p><pre class="language-ocaml"><code># walk_func_decl context name parameters return_type</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-walk_func_stmt"><a href="#val-walk_func_stmt" class="anchor"></a><code><span><span class="keyword">val</span> walk_func_stmt : 
  <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-func_arg">Syntax.ParseTree.func_arg</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ">Syntax.ParseTree.typ</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-stmt">Syntax.ParseTree.stmt</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>simply walk function's body inductively</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-walk_method_intf"><a href="#val-walk_method_intf" class="anchor"></a><code><span><span class="keyword">val</span> walk_method_intf : 
  <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-intf_name">Syntax.ParseTree.intf_name</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ_name">Syntax.ParseTree.typ_name</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>impl intf for T with methods, check whether intf exists and whether it has such methods</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-walk_method_decl"><a href="#val-walk_method_decl" class="anchor"></a><code><span><span class="keyword">val</span> walk_method_decl : 
  <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ_name">Syntax.ParseTree.typ_name</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-func_name">Syntax.ParseTree.func_name</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-func_arg">Syntax.ParseTree.func_arg</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ">Syntax.ParseTree.typ</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>similar to <a href="#val-walk_func_decl"><code>walk_func_decl</code></a>, but checked in the scope of type T</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-walk_method_stmt"><a href="#val-walk_method_stmt" class="anchor"></a><code><span><span class="keyword">val</span> walk_method_stmt : 
  <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-func_arg">Syntax.ParseTree.func_arg</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-typ">Syntax.ParseTree.typ</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-stmt">Syntax.ParseTree.stmt</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-walk_top"><a href="#val-walk_top" class="anchor"></a><code><span><span class="keyword">val</span> walk_top : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../Syntax@26bb1931b3ad/Syntax/ParseTree/index.html#type-top_clause">Syntax.ParseTree.top_clause</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><h2 id="usage"><a href="#usage" class="anchor"></a>Usage</h2><p>See <code>WalkerTest.ml</code> .</p></div></body></html>